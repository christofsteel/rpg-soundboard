var app=function(){var o=function(o){this.name=o.name,this.buffer=o.buffer||!1,this.sound=new Howl(this.buffer?{urls:[this.name],customBuffers:[this.buffer]}:{urls:[this.name]}),this.frequency=0,this.volume=70,this.interval=null,this.dom=this.genDom(this.name)};o.prototype.setFrequency=function(o){var n=this;this.frequency=o,null!=this.interval&&clearInterval(this.interval),o>0&&100>=o&&(this.interval=setInterval(function(){n.play()},1e3*(100/o-1)))},o.prototype.setVolume=function(o){console.log(this.name+" Volume set to "+o),this.volume=o,this.sound.volume(o/100)},o.prototype.genDom=function(o){var n=$("<input>").attr("type","range").attr("min","0").attr("max","100").attr("value",70),e=$("<span>").addClass("glyphicon glyphicon-volume-up"),a=$("<div>").addClass("col-xs-2").append(e),p=$("<div>").addClass("col-xs-9").append(n),s=$("<div>").addClass("row").append(a).append(p),t=$("<input>").attr("type","range").attr("min","0").attr("max","100").attr("value",0),l=$("<span>").addClass("glyphicon glyphicon-flash"),i=$("<div>").addClass("col-xs-2").append(l),r=$("<div>").addClass("col-xs-9").append(t),d=$("<div>").addClass("row").append(i).append(r),u=$("<div>").addClass("glyphicon glyphicon-play"),c=$("<div>").addClass("soundLabel").text(o),h=$("<a>").addClass("btn btn-default btn-circle").append(u),f=$("<div>").addClass("col-xs-4 col-sm-2 centerize slim hidden").append(h).append(c).append(d).append(s),m=this;return h.click(function(){m.play()}),t.change(function(){m.setFrequency(this.value)}),n.change(function(){m.setVolume(this.value)}),f},o.prototype.show=function(){this.dom.removeClass("hidden")},o.prototype.hide=function(){this.dom.addClass("hidden")},o.prototype.play=function(){this.sound.play()};var n=function(o){this.name=o,this.dom=this.genDom(o),this.sounds=[]};n.prototype.genDom=function(o){var n=$("<option>").text(o),e=this;return n.onSelect=function(){console.log("Changed to "+o),app.sounds.All.sounds.forEach(function(o){o.hide()}),e.sounds.forEach(function(o){o.show()})},n};var e=function(o){this.name=o.name,this.buffer=o.buffer||!1,this.dom=this.genDom(this.name),this.loop=new Howl(this.buffer?{urls:[this.name],customBuffers:[this.buffer],volume:.7,loop:!0}:{urls:[this.name],volume:.7,loop:!0}),console.log(this.name+" loaded")};e.prototype.genDom=function(o){var n=$("<span>").addClass("glyphicon glyphicon-play"),e=$("<a>").attr("href","#").addClass("list-group-item").append(n).append(" "+o),a=this;return e.click(function(){app.currentloop==a?(app.currentloop.dom.removeClass("active"),app.currentloop.dom.find(".glyphicon").removeClass("glyphicon-stop"),app.currentloop.dom.find(".glyphicon").addClass("glyphicon-play"),app.currentloop.loop.fadeOut(0,500),app.currentloop=null):(null!=app.currentloop&&(app.currentloop.dom.removeClass("active"),app.currentloop.dom.find(".glyphicon").removeClass("glyphicon-stop"),app.currentloop.dom.find(".glyphicon").addClass("glyphicon-play")),a.dom.addClass("active"),a.dom.find(".glyphicon").addClass("glyphicon-stop"),a.dom.find(".glyphicon").removeClass("glyphicon-play"),a.start())}),e},e.prototype.start=function(){console.log(this.name+" started"),null!=app.currentloop&&app.currentloop.loop.fadeOut(0,3e3),app.currentloop=this,app.currentloop.loop.fadeIn(app.volume,3e3)};var a=function(a){var p=new JSZip(a.target.result),s=p.file(/^loops\/[^\/]*$/);s.forEach(function(o){var n=o.name.replace(/loops\//,"");console.log("Added loop "+n);var a=new e({name:n,buffer:o.asArrayBuffer()});app.loops.push(a),app.loopcontainer.append(a.dom)});var t=p.folder(/^sounds\/[^\/]*\/$/);t.forEach(function(e){var a=e.name.replace(/sounds\//,"").replace(/\//,""),s=p.folder(e.name).file(/./);app.sounds[a]=new n(a),app.soundsetsContainer.append(app.sounds[a].dom),s.forEach(function(n){var e=n.name.replace(/^.*\//,""),p=new o({name:e,buffer:n.asArrayBuffer()});app.sounds.All.sounds.push(p),app.sounds[a].sounds.push(p),app.soundsContainer.append(p.dom)}),app.sounds.All.dom.onSelect()})},p=function(){app.soundsetsContainer=$("#soundsets"),app.soundsContainer=$("#sounds"),app.soundsetsContainer.change(function(){var o=$("#soundsets option:selected").text();app.sounds[o].dom.onSelect()}),app.sounds={},app.sounds.All=new n("All"),app.soundsetsContainer.append(app.sounds.All.dom),app.loops=[],app.volume=.7,app.currentloop=null,app.loopcontainer=$("#backgrounds");var o=$("#bg-vol");o.change(function(){console.log("BG Volume:"+this.value),app.volume=this.value/100,null!=app.currentloop&&app.currentloop.loop.volume(app.volume)});var e=$("#files");e.change(function(o){var n=o.target.files[0],e=new FileReader;e.onload=a,e.readAsArrayBuffer(n)})};return{initialize:p,Sound:o,Soundset:n,sounds:sounds,Loop:e}}();app.initialize();